!function(e,n){"use strict";var r,t;"undefined"==typeof exports||e!==exports&&null!=e||(r=t=global,null!=t.logger&&(t=module.exports)),null==r&&(r="undefined"==typeof window?global:window),null==t&&(t=e||r),n(r,t)}(this,function(e,n){"use strict";function r(e){return Object.prototype.toString.call(e).replace("[object ","").replace("]","")}function t(e,n){if(null==n)return e;for(var r in n)e[r]=n[r];return e}function i(){return this}var u,o=require("atma-formatter"),l={logCaller:!0,logDate:!1},c=50,a=function(){function e(t){if(null==t)return t;var i,u=r(t);switch(u){case"String":case"Number":case"Date":case"RegExp":case"Function":case"Error":case"Boolean":return t;case"Array":case"Arguments":i=[];for(var o=0,l=t.length;l>o;o++)i[o]=e(t[o]);return i;case"Object":case"global":if(-1!==n.indexOf(t))return"<circular>";n.push(t),i={};for(var c in t)i[c]=e(t[c]);return i;default:return console.warn("obj_dimissCircular: Unknown type",u),t}}var n;return function(r){return"object"==typeof r&&null!=r&&(n=[],r=e(r),n=null),r}}(),f=function(){function e(e){for(var n="",r=0;e>r;r++)n+="  ";return n}return function n(t,i,u){null==u&&(u=0);var o=["",0];if("undefined"==typeof t)return o[1]="<undefined>",i(o,"undefined"),o[1];if(null==t)return o[1]="<null>",i(o,"null"),o[1];var l=r(t);switch(l){case"Array":case"Arguments":for(var c,a="[",f=t,s=0,g=f.length;g>s;s++)c=f[s],"["===a&&(a+="\n"),a+=e(u+1)+n(c,i,u+1)+(g-1>s?",":"")+"\n";return a+=e(u)+"]";case"RegExp":return o[1]=t.toString(),i(o,"regexp"),o[1];case"Date":return o[1]=t.toISOString(),i(o,"date"),o[1];case"String":case"Number":case"Boolean":return o[1]=t,i(o,l.toLowerCase()),o[1];case"Function":return o[1]="<function>",i(o,l.toLowerCase()),o[1];case"Error":return t.toString().red;case"Object":case"global":var h,a="{",d=Object.keys(t);for(s=0,g=d.length;g>s;s++)h=d[s],"{"===a&&(a+="\n"),o[0]=h,o[1]=t[h],i(o),a+=e(u+1)+o[0]+": "+n(t[h],i,u+1)+(g-1>s?",":"")+"\n";return a+=e(u)+"}"}}}();!function(){function e(e){")"===e[e.length-1]&&(e=e.substr(e.indexOf("(")+1,e.lastIndexOf(")")-1));var t=/^(.+):(\d+):(\d)/.exec(e);if(null==t)return null;var i=r.path=t[1];return r.file=i.substring(i.search(/[\/\\][^\/\\]+$/)+1),r.line=t[2],null==n&&(n=r.file),r}var n,r={path:null,file:null,line:null};u=function(r){for(var t,i=(new Error).stack.split("\n").splice(1),u=i.length,o=-1;++o<u&&(t=e(i[o]),null==t||null==n||t.file===n););return null==t||o===u?"":r.replace("P",t.path).replace("F",t.file).replace("L",t.line)}}();var s;!function(){s=function(e){return"string"!=typeof e&&(e="dd-MM hh:mm:ss"),o(new Date,e)}}();var g,h;!function(){h=function(e){var n=g(e);return l.logCaller!==!1&&(n+=u(" (F:L)",5)),l.logDate!==!1&&(n=s(l.logDate)+" "+n),n},g=function(e){for(var n,r,t="",i=/%s|%d/,u=e.length>1&&"string"==typeof e[0]&&i.test(e[0]),o=0,l=e.length;l>o;o++)r=e[o],n="string"==typeof r?r:d.formatJSON(r),o>0&&u&&i.test(t)?t=t.replace(i,n):(""!==t&&(t+="  "),t+=n);return t}}();var d=function(){function e(e){function n(e,n){for(var r,t=1,i=e.length,u=n;i>u;u++)if(r=e.charCodeAt(u),60===r&&t++,62===r&&t--,0===t)return u;return-1}function r(r){e.rgx_search.lastIndex=0;for(var i,u,o,l="ascii"===e.type,c=l?[]:null;i=e.rgx_search.exec(r),null!=i;)if(u=i[1],null!=e.value[u]){var a,f=i.index,s=f+i[0].length;o=n(r,s),-1!==o&&(a=e.start(u),r=r.substring(0,f)+a+r.substring(s,o)+e.END+(l?t(c,o):"")+r.substring(o+1),l&&c.push({end:o,key:u}),e.rgx_search.lastIndex=f+a.length)}return r}function t(n,r){for(var t,i="",u=0,o=n.length;o>u;u++)t=n[u],t.end<r||(i+=e.start(t.key));return i}if(null==e.rgx_search){var i="(";for(var u in e.value)i+="("===i?u:"|"+u;i+=")<",e.rgx_search=new RegExp(i,"g")}return Object.keys(e.value).forEach(function(n){try{Object.defineProperty(String.prototype,n,{get:function(){return e.start(n)+this+e.END},enumerable:!1,configurable:!0})}catch(r){}}),Object.defineProperty(String.prototype,"color",{get:function(){return r(this)},enumerable:!1,configurable:!0}),r}var n,r={END:"",value:{red:"",green:"",yellow:"",blue:"",magenta:"",cyan:"",bold:"",italic:"",underline:"",inverse:""},start:function(){return""}},t={END:"</span>",value:{red:"color:red",green:"color:green",yellow:"color:yellow",blue:"color:blue",magenta:"color:magenta",cyan:"color:cyan",bold:"font-weight:bold",italic:"font-style:italic",underline:"text-decoration:underline",inverse:"color:black;background:white"},start:function(e){var n='<span style="'+this.value[e]+'">';return n}},i={type:"ascii",START:"[",END:"[0m",value:{red:"31m",green:"32m",yellow:"33m",blue:"34m",magenta:"35m",cyan:"36m",white:"37m",black:"30m",bg_black:"40m",bg_red:"41m",bg_green:"42m",bg_yellow:"43m",bg_blue:"44m",bg_magenta:"45m",bg_cyan:"46m",bg_white:"47m",bold:"1m",italic:"3m",underline:"4m",inverse:"7m"},start:function(e){return this.START+this.value[e]}};n=e(i);var u={string:"yellow",number:"cyan","boolean":"cyan",regexp:"magenta",date:"magenta","function":"magenta","null":"blue",undefined:"blue"};return{init:{ascii:function(){n=e(i)},html:function(){n=e(t)},none:function(){n=e(r)}},colorize:function(e){return n(e)},formatJSON:function(e){var n=e;return void 0!==n&&"object"==typeof n&&(n=a(e)),f(n,function(e,n){n&&u[n]&&(e[1]=String(e[1])[u[n]]),e[0]&&(e[0]=e[0].bold)})},define:function(e){return d.init[e]?d.init[e]():void console.error("Invalid Color Type ",e)}}}(),v=function(){var e,n={};return n.std=function(){return{write:function(e){process.stdout.write("\n"+e)},cfg:function(){}}}(),n.fs=function(){function e(e){d.appendFileSync(h.resolve(n,"logger-exceptions.txt"),g([e]))}var n,r,t,i,u,c,a,f,s,h=require("path"),d=require("fs"),v="logs",b="txt",p=require("os").EOL,y=524288e3,m=10,w=64,S=!1;!function(){var n=require("fs");require("path"),a=function(e){try{var r=n.statSync(e);return r&&r.size}catch(t){return 0}},f=function(r,t){n.unlink(r,function(n){n&&e(n),t(n)})},s=function(e){try{n.unlink(e)}catch(r){}},c=function(r,t,i){n.open(r,"a",function(r,u){if(null!=r)return e(r),void i(r);var o=new Buffer(t,"utf8");n.write(u,o,0,o.length,0,function(r){return r?(e(r),void i(r)):void n.close(u,i)})})},u=function(e,r){try{var t=n.openSync(e,"a");n.writeSync(t,r),n.closeSync(t)}catch(i){console.error(">> error",i)}}}();var x,_;!function(){x=function(n){try{return d.readdirSync(n)}catch(r){return e(r),[]}},_=function(n){if(!d.existsSync(n)){_(h.dirname(n));try{d.mkdirSync(n)}catch(r){e(r)}}}}();var k=function(e,r){this.buffer=[],this.path=h.resolve(n,e)+"."+t,this.size=r!==!0?0:a(this.path)};k.prototype={busy:!1,errored:!1,write:function(e){this.size+=e.length,this.buffer.push(e),this.buffer.length>w&&this[S?"flushSync":"flush"](),this.size>y&&O()},flush:function(){var e,n=this;n.busy||(n.busy=!0,e=this.getBuffer_(),c(n.path,e,function(){n.busy=!1}))},flushSync:function(){u(this.path,this.getBuffer_())},getBuffer_:function(){if(0===this.buffer.length)return"";var e=this.buffer.join(i)+i;return this.buffer.length=0,e}};var E,O;return function(){E=function(){i="html"===l.color?"<br/>":p,_(n);for(var e,t=x(n).sort(),u=t.length,o=-1,c=/^\d+_/g;++o<u&&(e=t[o],!c.test(e)););r=u>o?new k(e.replace(/\.\w+$/,""),!0):O(),t.length>m&&t.slice(m).forEach(function(e){s(h.resolve(n,e))})},O=function(){null!=r&&r.flush();var e=new Date;return r=new k(e.getTime()+"_"+o(e,"dd-MM_hh"))}}(),{write:function(e){null==r&&E(),r.write(e)},flush:function(){r.flushSync()},cfg:function(e){t=e.extension||b,n=h.resolve(h.dirname(module.parent.filename),e.directory||v),null!=e.bufferSize&&(w=e.bufferSize),e.filesCount&&(m=e.filesCount),e.fileSize&&(y=e.fileSize),null!=e.sync&&(S=e.sync)}}},e=n.std,{define:function(r){var t=r.type;return e=n[t],"function"==typeof e&&(e=e()),e.cfg(r),this},write:function(n){e.write(n)}}}(),b=function(){function e(e,n){switch(e){case"level":c=n;break;case"transport":v.define(n);break;case"color":d.define(n);case"logCaller":case"logDate":default:l[e]=n}}function n(e){return e>c?u:r}var r={cfg:function(n){if("string"==typeof n){if(1===arguments.length)return l[n];e(n,arguments[1])}for(var r in n)e(r,n[r])},color:d,formatMessage:function(){return g(arguments)},log:function(){return v.write(h(arguments)),this},error:function(){return v.write(h(arguments).red.bold),this},warn:function(){return v.write(h(arguments).yellow),this}},u={cfg:r.cfg,color:r.color,log:i,error:i,warn:i};return t(n,r),n}();if("udefined"!=typeof process)for(var p,y=process.argv.slice(2),m=0,w=y.length;w>m;m++)switch(p=y[m].replace(/^\-+/,"")){case"no-color":b.cfg("color","none");break;case"level":var S=y[++m]<<0;if(0===S){b.warn("<logger> invalid cli command --level X");break}b.cfg("level",S)}n.logger=b});
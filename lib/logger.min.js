!function(e,n){"use strict";var r,t;"undefined"==typeof exports||e!==exports&&null!=e||(r=t=global,null!=t.logger&&(t=module.exports)),null==r&&(r="undefined"==typeof window?global:window),null==t&&(t=e||r),n(r,t)}(this,function(e,n){"use strict";function r(e){return Object.prototype.toString.call(e).replace("[object ","").replace("]","")}function t(e,n){if(null==n)return e;for(var r in n)e[r]=n[r];return e}function i(){return this}var u,o=require("atma-formatter"),l={logCaller:!0,logDate:!1},a=50,c=function(){function e(t){if(null==t)return t;var i,u=r(t);switch(u){case"String":case"Number":case"Date":case"RegExp":case"Function":case"Error":case"Boolean":return t;case"Array":case"Arguments":i=[];for(var o=0,l=t.length;l>o;o++)i[o]=e(t[o]);return i;case"Object":case"global":if(-1!==n.indexOf(t))return"<circular>";n.push(t),i={};for(var a in t)i[a]=e(t[a]);return i;default:return console.warn("obj_dimissCircular: Unknown type",u),t}}var n;return function(r){return"object"==typeof r&&null!=r&&(n=[],r=e(r),n=null),r}}(),f=function(){function e(e){for(var n="",r=0;e>r;r++)n+="  ";return n}return function n(t,i,u){null==u&&(u=0);var o=["",0];if("undefined"==typeof t)return o[1]="<undefined>",i(o,"undefined"),o[1];if(null==t)return o[1]="<null>",i(o,"null"),o[1];var l=r(t);switch(l){case"Array":case"Arguments":for(var a,c="[",f=t,s=0,g=f.length;g>s;s++)a=f[s],"["===c&&(c+="\n"),c+=e(u+1)+n(a,i,u+1)+(g-1>s?",":"")+"\n";return c+=e(u)+"]";case"RegExp":return o[1]=t.toString(),i(o,"regexp"),o[1];case"Date":return o[1]=t.toISOString(),i(o,"date"),o[1];case"String":case"Number":case"Boolean":return o[1]=t,i(o,l.toLowerCase()),o[1];case"Function":return o[1]="<function>",i(o,l.toLowerCase()),o[1];case"Error":return t.toString().red;case"Object":case"global":var h,c="{",d=Object.keys(t);for(s=0,g=d.length;g>s;s++)h=d[s],"{"===c&&(c+="\n"),o[0]=h,o[1]=t[h],i(o),c+=e(u+1)+o[0]+": "+n(t[h],i,u+1)+(g-1>s?",":"")+"\n";return c+=e(u)+"}"}}}();!function(){function e(e){")"===e[e.length-1]&&(e=e.substr(e.indexOf("(")+1,e.lastIndexOf(")")-1));var t=/^(.+):(\d+):(\d)/.exec(e);if(null==t)return null;var i=r.path=t[1];return r.file=i.substring(i.search(/[\/\\][^\/\\]+$/)+1),r.line=t[2],null==n&&(n=r.file),r}var n,r={path:null,file:null,line:null};u=function(r){for(var t,i=(new Error).stack.split("\n").splice(1),u=i.length,o=-1;++o<u&&(t=e(i[o]),null==t||null==n||t.file===n););return null==t||o===u?"":r.replace("P",t.path).replace("F",t.file).replace("L",t.line)}}();var s,g;!function(){g=function(){var e=s.apply(null,arguments);return l.logCaller!==!1&&(e+=u(" (F:L)",5)),l.logDate!==!1&&(e=date_formatForMessage(new Date,l.logDate)+" "+e),e},s=function(){for(var e,n,r=arguments,t="",i=/%s|%d/,u=r.length>1&&"string"==typeof r[0]&&i.test(r[0]),o=0,l=r.length;l>o;o++)n=r[o],e="string"==typeof n?n:h.formatJSON(n),o>0&&u&&i.test(t)?t=t.replace(i,e):(""!==t&&(t+="  "),t+=e);return t}}();var h=function(){function e(e){function n(e,n){for(var r,t=1,i=e.length,u=n;i>u;u++)if(r=e.charCodeAt(u),60===r&&t++,62===r&&t--,0===t)return u;return-1}function r(r){e.rgx_search.lastIndex=0;for(var i,u,o,l="ascii"===e.type,a=l?[]:null;i=e.rgx_search.exec(r),null!=i;)if(u=i[1],null!=e.value[u]){var c,f=i.index,s=f+i[0].length;o=n(r,s),-1!==o&&(c=e.start(u),r=r.substring(0,f)+c+r.substring(s,o)+e.END+(l?t(a,o):"")+r.substring(o+1),l&&a.push({end:o,key:u}),e.rgx_search.lastIndex=f+c.length)}return r}function t(n,r){for(var t,i="",u=0,o=n.length;o>u;u++)t=n[u],t.end<r||(i+=e.start(t.key));return i}if(null==e.rgx_search){var i="(";for(var u in e.value)i+="("===i?u:"|"+u;i+=")<",e.rgx_search=new RegExp(i,"g")}return Object.keys(e.value).forEach(function(n){try{Object.defineProperty(String.prototype,n,{get:function(){return e.start(n)+this+e.END},enumerable:!1,configurable:!0})}catch(r){}}),Object.defineProperty(String.prototype,"color",{get:function(){return r(this)},enumerable:!1,configurable:!0}),r}var n,r={END:"",value:{red:"",green:"",yellow:"",blue:"",magenta:"",cyan:"",bold:"",italic:"",underline:"",inverse:""},start:function(){return""}},t={END:"</span>",value:{red:"color:red",green:"color:green",yellow:"color:yellow",blue:"color:blue",magenta:"color:magenta",cyan:"color:cyan",bold:"font-weight:bold",italic:"font-style:italic",underline:"text-decoration:underline",inverse:"color:black;background:white"},start:function(e){var n='<span style="'+this.value[e]+'">';return n}},i={type:"ascii",START:"[",END:"[0m",value:{red:"31m",green:"32m",yellow:"33m",blue:"34m",magenta:"35m",cyan:"36m",white:"37m",black:"30m",bg_black:"40m",bg_red:"41m",bg_green:"42m",bg_yellow:"43m",bg_blue:"44m",bg_magenta:"45m",bg_cyan:"46m",bg_white:"47m",bold:"1m",italic:"3m",underline:"4m",inverse:"7m"},start:function(e){return this.START+this.value[e]}};n=e(i);var u={string:"yellow",number:"cyan","boolean":"cyan",regexp:"magenta",date:"magenta","function":"magenta","null":"blue",undefined:"blue"};return{init:{ascii:function(){n=e(i)},html:function(){n=e(t)},none:function(){n=e(r)}},colorize:function(e){return n(e)},formatJSON:function(e){var n=e;return void 0!==n&&"object"==typeof n&&(n=c(e)),f(n,function(e,n){n&&u[n]&&(e[1]=String(e[1])[u[n]]),e[0]&&(e[0]=e[0].bold)})},define:function(e){return h.init[e]?h.init[e]():void console.error("Invalid Color Type ",e)}}}(),d=function(){var e,n={};return n.std=function(){return{write:function(e){process.stdout.write("\n"+e)},cfg:function(){}}}(),n.fs=function(){function e(e){f.appendFileSync(c.resolve(n,"logger-exceptions.txt"),s([e]))}var n,r,t,i,u,l,a,c=require("path"),f=require("fs"),g="logs",h="txt",d=require("os").EOL,v=524288e3,b=10,p=64,y=!1;!function(){var n=require("fs");require("path"),l=function(e){try{var r=n.statSync(e);return r&&r.size}catch(t){return 0}},a=function(r,t){n.unlink(r,function(n){n&&e(n),t(n)})},u=function(r,t,i){n.open(r,"a",function(r,u){if(null!=r)return e(r),void i(r);var o=new Buffer(t,"utf8");n.write(u,o,0,o.length,0,function(r){return r?(e(r),void i(r)):void n.close(u,i)})})},i=function(e,r){try{var t=n.openSync(e,"a");n.writeSync(t,r),n.closeSync(t)}catch(i){}}}();var m,w;!function(){m=function(n){try{return f.readdirSync(n)}catch(r){return e(r),[]}},w=function(n){if(!f.existsSync(n)){w(c.dirname(n));try{f.mkdirSync(n,777)}catch(r){e(r)}}}}();var S=function(e,r){this.buffer=[],this.path=c.resolve(n,e)+"."+t,this.size=r!==!0?0:l(this.path)};S.prototype={busy:!1,errored:!1,write:function(e){this.size+=e.length,this.buffer.push(e),this.buffer.length>p&&this[y?"flush":"flushSync"](),this.size>v&&_()},flush:function(){var e,n=this;n.busy||(n.busy=!0,e=this.getBuffer_(),u(n.path,e,function(){n.busy=!1}))},flushSync:function(){var e=this.getBuffer_();i(file.path,e)},getBuffer_:function(){var e=file.buffer.join(d);return file.buffer.length=0,e}};var x,_;return function(){x=function(){logger.log("initialize",n),w(n);for(var e,t=m(n).sort(),i=t.length,u=-1,o=/^\d+_/g;++u<i&&(e=t[u],!o.test(e)););r=i>u?new S(e,!0):_(),t.length>b&&t.slice(b).forEach(function(e){file_remove(c.resolve(n,e))})},_=function(){null!=r&&r.flush();var e=new Date;return r=new S(e.getTime()+"_"+o(e,"dd-MM_hh"))}}(),{write:function(e){null==r&&x(),r.write(e)},flush:function(){r.flushSync()},cfg:function(e){t=e.extension||h,n=c.resolve(c.dirname(module.parent.filename),e.directory||g),null!=e.bufferSize&&(p=e.bufferSize),e.filesCount&&(b=e.filesCount),e.fileSize&&(v=e.fileSize),null!=e.sync&&(y=e.sync)}}},e=n.std,{define:function(r){var t=r.type;return e=n[t],"function"==typeof e&&(e=e()),e.cfg(r),this},write:function(n){e.write(n)}}}(),v=function(){function e(e,n){switch(e){case"color":h.define(n);break;case"level":a=n;break;case"transport":d.define(n);break;case"logCaller":case"logDate":default:l[e]=n}}function n(e){return e>a?u:r}var r={cfg:function(n){if("string"==typeof n){if(1===arguments.length)return l[n];e(n,arguments[1])}for(var r in n)e(r,n[r])},color:h,formatMessage:function(){return s(arguments)},log:function(){return d.write(g(arguments)),this},error:function(){return d.write(g(arguments).red.bold),this},warn:function(){return d.write(g(arguments).yellow),this}},u={cfg:r.cfg,color:r.color,log:i,error:i,warn:i};return t(n,r),n}();if("udefined"!=typeof process)for(var b,p=process.argv.slice(2),y=0,m=p.length;m>y;y++)switch(b=p[y].replace(/^\-+/,"")){case"no-color":v.cfg("color","none");break;case"level":var w=p[++y]<<0;if(0===w){v.warn("<logger> invalid cli command --level X");break}v.cfg("level",w)}n.logger=v});